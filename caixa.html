<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="estilo_caixa.css">
    <title>sistema de caixa</title>
</head>
<body>
    <div class="caixa">
        <div class="header-content">
            <div style="width: 100%; color: aliceblue; text-align: center;">
                <h1>sistema de caixa</h1>
            </div>
            <div class="product-registration">
                <p>Cadastrar Produto</p>
                <input type="text" id="product-name" placeholder="Nome do Produto">
                <input type="number" id="quantidade-product" placeholder="Quantidade de Produto">
                <button onclick="procurarProduct()">Procurar Produto</button>
            </div>
            <div class="payment-section">
                <p>Pagamento</p>
                <div id="installments-section" style="display: none;">
                    <input type="number" id="installments" placeholder="Número de Parcelas">
                </div>
                <input type="number" id="amount-paid" placeholder="Valor Pago">
                <div style="display: flex;width: 100%; background-color: rgba(0, 255, 255, 0);">
                    <p>FORMA DE PAGAMENTO :</p>
                    <select id="payment-method" style="width: 100px; height: 50px; margin: 5px;" onchange="showInstallments()">
                        <option value="pix">Pix</option>
                        <option value="debito">Débito</option>
                        <option value="credito">Crédito</option>
                        <option value="dinheiro">Dinheiro</option>
                    </select>
                    <button style="width: 100px; margin: 10px;" onclick="calculateChange()">Calcular Troco</button>
                </div>
            </div>
        </div>
    </div>
    <div class="main">
        <div style="width: 100%; background-color: rgba(236, 8, 8, 0.726); color: rgb(255, 255, 255); text-align: center;">
            <h1>historico</h1>
        </div>
        <div class="historico_produto" id="main-content" style="background-color: aliceblue;">
            <div class="card"></div>
            <div class="historico">
                <div class="conteudo_historico"></div>
            </div>
        </div>
        <div class="card-body">
            <div id="result" class="result-box"></div>
        </div>
    </div>
    <script>
        let historyData = [];
        let totalValue = 0;

        function procurarProduct() {
            const productName = document.getElementById('product-name').value.toLowerCase();
            const quantidadeProduct = parseFloat(document.getElementById('quantidade-product').value);

            if (productName === '' || isNaN(quantidadeProduct)) {
                alert('Por favor, preencha todos os campos corretamente.');
                return;
            }

            const savedData = JSON.parse(localStorage.getItem('historyData')) || [];
            const foundProduct = savedData.find(item => item.productName.toLowerCase() === productName);

            if (foundProduct) {
                const productTotal = foundProduct.productValue * quantidadeProduct;
                totalValue += productTotal;
                const data = {
                    productName: foundProduct.productName,
                    productValue: productTotal.toFixed(2),
                    productUnitValue: foundProduct.productValue,
                    productQuantity: quantidadeProduct
                };
                historyData.push(data);
                updateHistory();
                updateTotalValue();
                clearProductInputs();
                saveToLocalStorage(); // Salvar dados após registrar um produto
            } else {
                alert('Produto não encontrado!');
            }
        }

        function calculateChange() {
            const paymentMethod = document.getElementById('payment-method').value;
            const amountPaid = parseFloat(document.getElementById('amount-paid').value);

            if (isNaN(amountPaid)) {
                alert('Por favor, preencha o valor pago corretamente.');
                return;
            }

            let change = amountPaid - totalValue;

            if (paymentMethod === 'credito') {
                const installments = parseInt(document.getElementById('installments').value);
                if (isNaN(installments) || installments <= 0) {
                    alert('Por favor, preencha o número de parcelas corretamente.');
                    return;
                }
                change = (totalValue / installments).toFixed(2);
            }

            const resultHtml = `
                <div class="result-content">
                    <p>Método de Pagamento: ${paymentMethod}</p>
                    <p>Valor Pago: ${amountPaid.toFixed(2)}</p>
                    ${paymentMethod === 'credito' ? `<p>Parcelas: ${document.getElementById('installments').value} x ${change}</p>` : `<p>Troco: ${change}</p>`}
                </div>
            `;

            const resultBox = document.getElementById('result');
            resultBox.innerHTML = resultHtml;

            if (paymentMethod !== 'credito' && change < 0) {
                resultBox.style.backgroundColor = 'red';
                resultBox.style.color = 'white'; // Texto em branco
            } else {
                resultBox.style.backgroundColor = 'green';
                resultBox.style.color = 'white'; // Texto em branco
            }
        }

        function updateHistory() {
            const historyContent = document.querySelector('.conteudo_historico');
            historyContent.innerHTML = '';
            historyData.forEach((entry, index) => {
                const entryHtml = `
                    <div class="historico-entry">
                        <p>Produto: ${entry.productName}</p>
                        <p>Quantidade: ${entry.productQuantity}</p>
                        <p>Valor do Produto (Unitário): ${entry.productUnitValue}</p>
                        <p>Valor Total: ${entry.productValue}</p>
                        <button style="background-color: red; color: aliceblue;" onclick="deleteEntry(${index})">Excluir</button>
                    </div>
                `;
                historyContent.innerHTML += entryHtml;
            });
        }

        function updateTotalValue() {
            const totalHtml = `
                <div class="result-content">
                    <p>Valor Total Acumulado: ${totalValue.toFixed(2)}</p>
                </div>
            `;
            document.getElementById('result').innerHTML = totalHtml;
        }

        function deleteEntry(index) {
            totalValue -= parseFloat(historyData[index].productValue);
            historyData.splice(index, 1);
            updateHistory();
            updateTotalValue();
            saveToLocalStorage(); // Salvar dados após excluir um produto
        }

        function clearProductInputs() {
            document.getElementById('product-name').value = '';
            document.getElementById('quantidade-product').value = '';
        }

        function showInstallments() {
            const paymentMethod = document.getElementById('payment-method').value;
            const installmentsSection = document.getElementById('installments-section');
            if (paymentMethod === 'credito') {
                installmentsSection.style.display = 'block';
            } else {
                installmentsSection.style.display = 'none';
                document.getElementById('installments').value = '';
            }
        }

        function saveData() {
            const dataToSave = {
                historyData,
                totalValue
            };
            console.log('Dados salvos:', JSON.stringify(dataToSave));
            alert('Dados salvos no console.');
        }

        // Função para salvar dados no localStorage
        function saveToLocalStorage() {
            const dataToSave = {
                historyData,
                totalValue
            };
            localStorage.setItem('salesData', JSON.stringify(dataToSave));
        }

        // Função para carregar dados do localStorage
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('salesData');
            if (savedData) {
                const parsedData = JSON.parse(savedData);
                historyData = parsedData.historyData || [];
                totalValue = parsedData.totalValue || 0;
                updateHistory();
                updateTotalValue();
            }
        }

        // Carregar dados ao carregar a página
        window.onload = function() {
            loadFromLocalStorage();
        }
    </script>
</body>
</html>
